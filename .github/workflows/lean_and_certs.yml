steps:
  - uses: actions/checkout@v4
    with:
      submodules: recursive

  - uses: leanprover/lean-action@v1

  - uses: leanprover-community/mathlib-cache-action@v1

  - name: Build Lean project
    run: lake build

  - name: Verify transparency artifacts
    run: |
      set -euo pipefail
      calc=$(sha256sum transparency/files.sha256 | awk '{print $1}')
      exp=$(cat transparency/merkle.root)
      [ "$calc" = "$exp" ]

      calc2=$(sha256sum lean-attest/LEAN_BUILD_ATTEST.txt | awk '{print $1}')
      exp2=$(cat lean-attest/LEAN_BUILD_ATTEST.sha256)
      [ "$calc2" = "$exp2" ]

